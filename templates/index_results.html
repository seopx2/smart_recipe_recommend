<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì¶”ì²œ ê²°ê³¼</title>
  <link rel="stylesheet" href="/static/style_final.css">
</head>
<body>
  <h1 class="final_title">ì¶”ì²œ ë ˆì‹œí”¼ ê²°ê³¼</h1>
  <div id="loading">ì¶”ì²œì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div id="results"></div>

  <script>
    async function fetchRecommendation(ingredients) {
      try {
        const response = await fetch("http://127.0.0.1:8000//recommend", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ ingredients })
        });

        const data = await response.json();
        displayResults(data.recommendations);
      } catch (err) {
        document.getElementById("loading").innerText = "ì¶”ì²œì— ì‹¤íŒ¨í–ˆì–´ìš” ğŸ˜¢";
        console.error(err);
      }
    }

    function displayResults(results) {
      const loading = document.getElementById("loading");
      const resultsDiv = document.getElementById("results");
      loading.remove();

      if (results.length === 0) {
        resultsDiv.innerHTML = "<p>ì¶”ì²œí•  ë ˆì‹œí”¼ê°€ ì—†ì–´ìš”.</p>";
        return;
      }

      results.forEach(item => {
        const div = document.createElement("div");
        div.className = "result-item";
        div.innerHTML = `
          <h3>${item.ë©”ë‰´} (${item.ë§¤ì¹­ë¥  * 100}%)</h3>
          <p><strong>ë¶€ì¡± ì¬ë£Œ:</strong> ${item.ë¶€ì¡±ì¬ë£Œ.join(", ")}</p>
          <p><strong>ë ˆì‹œí”¼:</strong> ${item.ë ˆì‹œí”¼}</p>
          <hr>
        `;
        resultsDiv.appendChild(div);
      });
    }

    function getIngredientsFromURL() {
      const params = new URLSearchParams(window.location.search);
      const ings = params.get("ings");
      if (!ings) return [];
      return ings.split(",").map(decodeURIComponent);
    }

    // ì‹¤í–‰
    const ingredients = getIngredientsFromURL();
    if (ingredients.length > 0) {
      fetchRecommendation(ingredients);
    } else {
      document.getElementById("loading").innerText = "ì¬ë£Œê°€ ì—†ìŠµë‹ˆë‹¤.";
    }
  </script>
</body>
</html>
