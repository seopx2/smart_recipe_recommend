<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì¶”ì²œ ë ˆì‹œí”¼ ê²°ê³¼</title>
  <link rel="stylesheet" href="/static/result_st.css">
  <style>
    /* ì¹´ë“œ UI ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    .card {
      width: 80%;
      max-width: 500px;
      margin: 20px auto;
      background: #f9f9f9;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card-image {
      height: 160px;
      background-color: #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: #777;
    }

    .card-title {
      font-size: 20px;
      font-weight: bold;
      padding: 10px 0;
    }

    .card-link {
      font-size: 14px;
      color: orange;
      margin-bottom: 12px;
    }

    .card-content {
      background-color: white;
      padding: 10px;
      text-align: center;
    }

    .final_title {
      text-align: center;
      font-size: 28px;
      margin-top: 40px;
    }

    #loading {
      text-align: center;
      margin-top: 30px;
      font-size: 18px;
      color: gray;
    }
  </style>
</head>
<body>
  <h1 class="final_title">ë ˆì‹œí”¼ ì¶”ì²œ ê²°ê³¼</h1>
  <div id="loading">ì¶”ì²œì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div id="results"></div>

  <script>
    async function fetchRecommendation(ingredients) {
      try {
        const response = await fetch("http://127.0.0.1:8000/recommend", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ ingredients })
        });

        const data = await response.json();
        displayResults(data.recommendations);
      } catch (err) {
        document.getElementById("loading").innerText = "ì¶”ì²œì— ì‹¤íŒ¨í–ˆì–´ìš” ğŸ˜¢";
        console.error(err);
      }
    }

    function displayResults(results) {
      const loading = document.getElementById("loading");
      const resultsDiv = document.getElementById("results");
      loading.remove();

      if (!results || results.length === 0) {
        resultsDiv.innerHTML = "<p style='text-align: center;'>ì¶”ì²œí•  ë ˆì‹œí”¼ê°€ ì—†ì–´ìš”.</p>";
        return;
      }

      // localStorageì— ì €ì¥í•´ì„œ ìƒì„¸ í˜ì´ì§€ë¡œ ë„˜ê¸°ê¸°
      localStorage.setItem("recommendationData", JSON.stringify(results));
      localStorage.setItem("ingredients", JSON.stringify(ingredients));
      results.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "card";
        div.onclick = () => goToDetail(index);
        div.innerHTML = `
          <div class="card-content">
            <div class="card-title">${item.ë©”ë‰´}</div>
            <div class="card-link">[ìƒì„¸ ì •ë³´ ë³´ëŸ¬ê°€ê¸°]</div>
          </div>
        `;
        resultsDiv.appendChild(div);
      });
    }

    function goToDetail(index) {
      window.location.href = `/detail?id=${index}`;
    }

    function getIngredientsFromURL() {
      const params = new URLSearchParams(window.location.search);
      const ings = params.get("ings");
      if (!ings) return [];
      return ings.split(",").map(decodeURIComponent);
    }

    // ì‹¤í–‰
    const ingredients = getIngredientsFromURL();
    if (ingredients.length > 0) {
      fetchRecommendation(ingredients);
    } else {
      document.getElementById("loading").innerText = "ì¬ë£Œê°€ ì—†ìŠµë‹ˆë‹¤.";
    }
  </script>
</body>
</html>
