<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>추천 레시피 결과</title>
  <link rel="stylesheet" href="/static/result_st.css">
  <style>
    /* 카드 UI 기본 스타일 */
    .card {
      width: 80%;
      max-width: 500px;
      margin: 20px auto;
      background: #f9f9f9;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card-image {
      height: 160px;
      background-color: #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: #777;
    }

    .card-title {
      font-size: 20px;
      font-weight: bold;
      padding: 10px 0;
    }

    .card-link {
      font-size: 14px;
      color: orange;
      margin-bottom: 12px;
    }

    .card-content {
      background-color: white;
      padding: 10px;
      text-align: center;
    }

    .final_title {
      text-align: center;
      font-size: 28px;
      margin-top: 40px;
    }

    #loading {
      text-align: center;
      margin-top: 30px;
      font-size: 18px;
      color: gray;
    }
  </style>
</head>
<body>
  <h1 class="final_title">레시피 추천 결과</h1>
  <div id="loading">추천을 불러오는 중...</div>
  <div id="results"></div>

  <script>
    async function fetchRecommendation(ingredients) {
      try {
        const response = await fetch("http://127.0.0.1:8000/recommend", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ ingredients })
        });

        const data = await response.json();
        displayResults(data.recommendations);
      } catch (err) {
        document.getElementById("loading").innerText = "추천에 실패했어요 😢";
        console.error(err);
      }
    }

    function displayResults(results) {
      const loading = document.getElementById("loading");
      const resultsDiv = document.getElementById("results");
      loading.remove();

      if (!results || results.length === 0) {
        resultsDiv.innerHTML = "<p style='text-align: center;'>추천할 레시피가 없어요.</p>";
        return;
      }

      // localStorage에 저장해서 상세 페이지로 넘기기
      localStorage.setItem("recommendationData", JSON.stringify(results));
      localStorage.setItem("ingredients", JSON.stringify(ingredients));
      results.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "card";
        div.onclick = () => goToDetail(index);
        div.innerHTML = `
          <div class="card-content">
            <div class="card-title">${item.메뉴}</div>
            <div class="card-link">[상세 정보 보러가기]</div>
          </div>
        `;
        resultsDiv.appendChild(div);
      });
    }

    function goToDetail(index) {
      window.location.href = `/detail?id=${index}`;
    }

    function getIngredientsFromURL() {
      const params = new URLSearchParams(window.location.search);
      const ings = params.get("ings");
      if (!ings) return [];
      return ings.split(",").map(decodeURIComponent);
    }

    // 실행
    const ingredients = getIngredientsFromURL();
    if (ingredients.length > 0) {
      fetchRecommendation(ingredients);
    } else {
      document.getElementById("loading").innerText = "재료가 없습니다.";
    }
  </script>
</body>
</html>
